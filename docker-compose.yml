version: '3.8'

services:
  easyairclaim-mcp:
    build: .
    container_name: easyairclaim-mcp-server
    ports:
      - "39128:39128"  # SSE/MCP endpoint
      - "8083:8083"    # Dashboard endpoint
    environment:
      - ENVIRONMENT=development
      - DATABASE_URL=${DATABASE_URL}
      - MCP_HOST=0.0.0.0
      - MCP_PORT=39128
      - DASHBOARD_PORT=8083
      - LOG_LEVEL=INFO
      - ENABLE_DESTRUCTIVE_OPS=true
      - MAIN_APP_PATH=/app/easyairclaim
    volumes:
      # Mount main app code (read-only access to models/services)
      - /home/david/easyAirClaim/easyAirClaim:/app/easyairclaim:ro
      # Mount MCP server code (for development)
      - .:/app
    networks:
      - easyairclaim_nextcloud_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:39128/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  easyairclaim_nextcloud_network:
    external: true
